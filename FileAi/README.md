# FileAi - QQ文件解读插件

这个NoneBot2插件可以使用Kimi API解析QQ中的文件内容，并提供文件内容的总结和分析。

## 功能

- 回复包含文件的消息，同时@机器人并加上"解读"关键词，即可触发文件解析
- 支持多种文件格式，包括文本文件、文档、代码文件等
- 提取文件的关键信息和主要内容
- 显示处理用时、使用的模型信息
- 显示消耗的 Token 数量以及当前 API 余额
- 自动检测不支持的文件格式并提示用户
- 支持超级用户切换AI模型，提供多种容量选择

## 支持的文件格式

### 文档类
- PDF文件 (`.pdf`)
- 文本文档 (`.txt`)
- Excel表格 (`.csv`, `.xls`, `.xlsx`)
- Word文档 (`.doc`, `.docx`)
- PowerPoint演示文稿 (`.ppt`, `.pptx`)
- Markdown文档 (`.md`)
- 电子书 (`.epub`, `.mobi`)
- 网页文件 (`.html`)
- JSON数据 (`.json`)

### 日志和配置文件
- 日志文件 (`.log`)
- 配置文件 (`.yaml`, `.yml`, `.ini`, `.conf`)

### 代码类
- 常见编程语言文件 (`.go`, `.h`, `.c`, `.cpp`, `.cxx`, `.cc`, `.cs`, `.java`, `.js`, `.ts`, `.tsx`, `.php`, `.py`, `.py3`, `.asp`)
- 网页相关文件 (`.css`, `.jsp`)

## 安装和配置

1. 确保插件已放入正确的插件目录中

2. 在配置文件 `src/plugins/FileAi/config.py` 中设置以下参数：
   ```python
   class Config(BaseModel):
       CONFIG: dict = {
           "kimi_api_key": "你的Kimi API密钥",  # 从 Moonshot 平台获取
           "kimi_api_base_url": "https://api.moonshot.cn/v1",  # API 基础 URL
           "kimi_model": "moonshot-v1-32k",     # 使用的模型名称
       }
   ```

## 可用模型

插件支持多种Moonshot Kimi模型，你可以根据需要选择使用不同的模型:

- **moonshot-v1-128k**: 大容量模型，最大支持128k上下文长度，适合处理大型文档
- **moonshot-v1-32k**: 标准模型，支持32k上下文长度，适合大多数场景(默认)
- **moonshot-v1-8k**: 轻量级模型，支持8k上下文长度，处理速度较快

## 使用方法

### 文件解读

1. 有人在群聊中发送文件
2. 回复该文件消息，并在回复中@机器人，同时包含"解读"关键词和额外的解读指令
3. 机器人会下载该文件，使用Kimi API分析内容，然后发送分析结果

例如：
```
@机器人 解读 帮我总结一下这个文档的主要内容
@机器人 解读 提取这个文件中的关键信息
```

### 模型管理(仅超级用户)

1. 查看当前使用的模型
   ```
   @机器人 查看模型
   ```

2. 切换使用的模型
   ```
   @机器人 设置模型
   ```
   机器人会以交互式菜单方式列出可用模型，回复对应数字即可选择。

## 输出示例

解析完成后，机器人将返回如下格式的内容：

```
文件「example.pdf」的解读结果：

[解析内容...]

---
处理用时: 10秒
使用模型: moonshot-v1-32k
消耗Token: 1234
可用余额: 49.59
```

## 注意事项

- 需要机器人具有接收和下载文件的权限
- 大文件可能需要较长的处理时间
- 同一时间只能处理一个文件请求(有并发限制)
- 由于Kimi API的限制，不支持图片文件格式
- 使用前需要从Moonshot开放平台申请API密钥
- 每次解析都会消耗 Token，请关注余额情况
- 当前仅支持群聊文件解析
- 模型设置会被保存，重启机器人后依然生效
- 根据实际需求选择合适的模型，大容量模型消耗的token更多

## 错误处理

插件会自动处理常见错误，包括但不限于:

- 不支持的文件格式提示
- 文件下载失败的错误信息
- API调用失败的错误反馈
- 文件不存在的提示
- 并发请求限制提醒

## 版本历史

- **1.0.0**: 初始版本，支持基本文件解读功能
- **1.1.0**: 添加模型切换功能，支持多种容量模型
- **1.2.0**: 添加Token统计和余额查询功能