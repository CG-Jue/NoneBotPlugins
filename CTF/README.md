# CTF比赛推送插件

基于NoneBot2的CTF比赛信息推送与查询插件，支持国内和国际CTF赛事。

## 功能特点

- **自动推送**：定时推送即将开始的CTF比赛信息到指定QQ群
- **手动查询**：支持查询国内和国际CTF赛事的详细信息
- **数据全面**：同时支持国内和国际CTF赛事数据
- **权重筛选**：国际赛事可按权重筛选，只关注高质量比赛
- **富文本显示**：使用合并转发消息展示比赛信息，结构清晰不刷屏
- **多级分类**：比赛按国内/国际、正在进行/即将开始等维度分类展示
- **自动去重**：推送时自动去重，避免重复推送同一比赛
- **比赛排序**：按比赛开始时间排序，方便用户规划参赛

## 数据来源

- **国内CTF赛事**：来自 [ProbiusOfficial/Hello-CTFtime](https://github.com/ProbiusOfficial/Hello-CTFtime/blob/main/CN.json)
- **国际CTF赛事**：来自 [ProbiusOfficial/Hello-CTFtime](https://github.com/ProbiusOfficial/Hello-CTFtime/blob/main/Global.json)

## 安装方法

1. 确保已安装NoneBot2和OneBot V11适配器
2. 将本插件目录复制到NoneBot2的插件目录中
3. 在bot入口文件中加载此插件
4. 配置参数后启动机器人

### 依赖安装

```bash
pip install requests
```

本插件依赖`nonebot_plugin_apscheduler`，请确保该插件已正确安装并加载。

## 配置说明

在NoneBot2的配置文件(`.env`或`bot.py`)中添加以下配置：

```python
CTF_CONFIG = {
    "LIMIT_TIME": 30,        # 检查频率，单位为分钟，默认30分钟检查一次
    "SEND_TIME": 3,          # 提前几天推送，默认为3天
    "SEND_LIST": [12345678], # 需要推送的群号列表
    "GLOBAL_MIN_WEIGHT": 50  # 国际CTF最小权重阈值，默认为50
}
```

## 使用方法

### 自动推送

配置好`SEND_LIST`后，插件会自动定时检查比赛信息，并在符合条件时推送到指定群聊。
推送记录会保存在插件目录的`db.txt`文件中，以防重复推送。

### 手动查询

在群聊中发送以下命令：
- `/查询赛事` - 查询国内所有比赛和权重≥50的国际比赛
- `/查询赛事 25` - 查询国内所有比赛和权重≥25的国际比赛
- `/查询赛事 0` - 查询国内所有比赛和所有国际比赛（不进行权重筛选）

## 示例展示

### 自动推送消息

国内比赛推送示例：
```
（¯﹃¯）72小时内开始报名的国内比赛:
比赛名称: 某CTF比赛名称
报名时间: 
 04月12日 01:00 - 04月15日 01:00
比赛时间: 
 04月16日 01:00 - 04月17日 01:00
比赛链接: https://example.com
数据来源: Hello-CTFtime
获取其余赛事 /查询赛事 权重(可选)
```

国际比赛推送示例：
```
（¯﹃¯）72小时内开始的国际比赛:
比赛名称: 某CTF比赛名称
比赛时间（UTC+8）: 
 04月12日 01:00 - 04月13日 01:00
比赛形式: Jeopardy
比赛权重: 55.82（仅>=50）
赛事主办: 某比赛组织方
比赛链接: https://example.com
数据来源: Hello-CTFtime
获取其余赛事 /查询赛事 权重(可选)
```

### 手动查询结果

查询结果会以合并转发消息的形式展示，包含以下内容：
1. 总览信息：国内和国际比赛数量统计
2. 国内比赛详情：正在进行和即将开始的比赛分类展示
3. 国际比赛详情：正在进行和即将开始的比赛分类展示

每场比赛会展示以下信息：
- 比赛名称和状态
- 比赛时间（开始和结束时间）
- 报名时间（国内比赛特有）
- 比赛形式（如Jeopardy等）
- 比赛权重（国际比赛特有）
- 赛事主办方
- 联系方式（国内比赛可能包含）
- 比赛链接

## 文件结构

```
CTF/
├── __init__.py    # 主要功能实现
├── config.py      # 配置文件
├── db.txt         # 已推送比赛记录
├── README.md      # 说明文档
└── demo.json      # 示例数据（可选）
```

## 更新日志

### v1.0.0 (2025-04-11)
- 支持国内和国际CTF比赛自动推送
- 支持按权重筛选国际CTF比赛
- 实现多级合并转发消息展示比赛信息
- 提供比赛时间按早晚排序
- 适配新配置项和命令格式
- 添加推送去重功能

## 技术实现

- 使用`requests`库获取远程CTF比赛数据
- 使用`nonebot_plugin_apscheduler`实现定时检查和推送
- 通过合并转发消息API实现多级、结构化的比赛信息展示
- 使用文件系统记录已推送比赛，避免重复推送
- 根据比赛开始时间进行排序，优先展示即将开始的比赛

## 鸣谢

感谢 [ProbiusOfficial/Hello-CTFtime](https://github.com/ProbiusOfficial/Hello-CTFtime) 提供的CTF比赛数据。